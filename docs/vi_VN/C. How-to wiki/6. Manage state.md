# Manage state
```
Note: Hiá»‡n táº¡i, redux Ä‘Æ°á»£c sá»­ dá»¥ng chá»§ yáº¿u chá»‰ Ä‘á»ƒ tÆ°Æ¡ng thÃ­ch vá»›i code cá»§a Beiji gá»­i sang, nÃ³ sáº½ Ä‘Æ°á»£c thay tháº¿ dáº§n báº±ng context API, rxjs, ...
```

## 1. Folder structure
_(Folder structure nÃ y Ä‘Æ°á»£c Ã¡p dá»¥ng cho cáº£ global store vÃ  page store)_

```
ğŸ“‚stores
 â”£ ğŸ“‚store-name
 â”ƒ â”£ğŸ“œindex.ts
 â”ƒ â”£ğŸ“œepic.ts
 â”ƒ â”£ğŸ“œreducer.ts
 â”ƒ â”£ğŸ“œselector.ts
 â”—ğŸ“‚...
```
Thay vÃ¬ chia folder structure theo function(reducer, action, ...), store sáº½ Ä‘Æ°á»£c chia theo feature. Má»—i má»™t feature store sáº½ Ä‘Æ°á»£c Ä‘áº·t trong má»™t folder riÃªng vÃ  bÃªn trong lÃ  cÃ¡c action, reducer cho riÃªng feature Ä‘áº¥y.

Æ¯u Ä‘iá»ƒm so vá»›i function base folder structure:
- dá»… tÃ¬m kiáº¿m code hÆ¡n(thay vÃ¬ pháº£i tÃ¬m trong má»™t list file khÃ´ng liÃªn quan thÃ¬ chá»‰ cáº§n dá»±a vÃ o tÃªn folder sáº½ nhanh hÆ¡n)
- state á»Ÿ component nÃ o Ä‘áº·t cáº¡nh component Ä‘áº¥y sáº½ giÃºp dá»… quáº£n lÃ½.

Vai trÃ² cá»§a cÃ¡c file trong store:
- index.ts: Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ public reducers, actions, selectors, ...
- reducer.ts: nÆ¡i Ä‘á»‹nh nghÄ©a cÃ¡c pure reducer, initial state.
- epic.ts: nÆ¡i xá»­ lÃ½ cÃ¡c async event.

## 2. Scope
Trong viá»‡c quáº£n lÃ½ store, dÃ¹ sá»­ dá»¥ng redux, mobx, ngrx, rxjs, ... thÃ¬ cÅ©ng Ä‘á»u gáº·p khÃ³ trong viá»‡c má»Ÿ rá»™ng(thÃªm tÃ­nh nÄƒng, Ä‘áº·c biáº¿t lÃ  khi thÃªm ngÆ°á»i).

NguyÃªn nhÃ¢n cá»§a viá»‡c nÃ y lÃ  do store lÃ  public. Giá»‘ng nhÆ° khi viáº¿t class trong OOP thÃ¬ viá»‡c public táº¥t cáº£ dáº«n Ä‘áº¿n (API khÃ´ng clean) thÃ¬ sáº½ gáº·p khÃ³ trong viá»‡c sá»­a/xÃ³a code sau nÃ y thÃ¬ store cÅ©ng gáº·p váº¥n Ä‘á» tÆ°Æ¡ng tá»±.

Hiá»‡n táº¡i, dev chÆ°a tÃ¬m ra tool Ä‘á»ƒ kháº¯c phá»¥c nhÆ°á»£c Ä‘iá»ƒm nÃ y mÃ  chá»‰ cÃ³ cÃ¡ch sá»­ dá»¥ng tÃ i liá»‡u nÃ y Ä‘á»ƒ phÃ¢n chia scope/module vÃ  nháº¥n máº¡nh viá»‡c **Æ°u tiÃªn Ä‘áº·t máº·c Ä‘á»‹nh state trong local store(private)** thay vÃ¬ global/page store(public).

```
31/03/2022: React Context API kiá»ƒm soÃ¡t data scope khÃ¡ tá»‘t. NÃªn xÃ³a Redux.
```

Store Ä‘Æ°á»£c chia lÃ m 3 scope:
- Global store(public): chá»©a state dÃ¹ng chung cho toÃ n app(VD: thÃ´ng tin cá»§a user Ä‘Ã£ login, ...). Code Ä‘Æ°á»£c Ä‘áº·t trong folder `app/stores`.
- Page store(public): chá»©a state Ä‘Æ°á»£c dÃ¹ng chung cho chá»‰ má»™t page. Code Ä‘Æ°á»£c Ä‘áº·t trong folder `stores` cá»§a chÃ­nh page Ä‘Ã³. Page store khÃ´ng nháº¥t thiáº¿t pháº£i sá»­ dá»¥ng redux, cÃ³ thá»ƒ sá»­ dá»¥ng React Context(Æ¯u tiÃªn React Context hÆ¡n).
- Local store/component state/local state(private): chá»©a state chá»‰ Ä‘Æ°á»£c sá»­ dá»¥ng trong chÃ­nh component Ä‘Ã³.

Thá»© tá»± Æ°u tiÃªn Ä‘áº·t state láº§n lÆ°á»£t lÃ :
- local state -> page store -> global store.

Náº¿u chÆ°a xÃ¡c Ä‘á»‹nh ngay Ä‘Æ°á»£c scope cá»§a store tá»« Ä‘áº§u thÃ¬ cÃ³ thá»ƒ dÃ¹ng má»™t sá»‘ quy táº¯c sau Ä‘á»ƒ xÃ¡c Ä‘á»‹nh vá»‹ trÃ­ nÃªn Ä‘áº·t store:
- Náº¿u chá»‰ 1 component cáº§n sá»­ dá»¥ng state thÃ¬ hÃ£y Ä‘á»ƒ trong local store.
- Náº¿u tá»« 2 component **trong má»™t page** cáº§n chia sáº» state thÃ¬ hÃ£y Ä‘áº©y lÃªn page store.
- Náº¿u tá»« 2 page cáº§n chia sáº» state thÃ¬ hÃ£y Ä‘áº©y lÃªn global store.

## 3. CÃ¡c global (feature)store
- `app/stores/loggedInUser`: quáº£n lÃ½ thÃ´ng tin cá»§a user Ä‘Ã£ login.
- `app/stores/sidebar`: quáº£n lÃ½ tráº¡ng thÃ¡i Ä‘Ã³ng má»Ÿ cá»§a sidebar(layout normal).

## 4. Redux toolkit
So vá»›i redux thuáº§n cáº§n nhiá»u boilerplate code thÃ¬ redux toolkit cÅ©ng cháº³ng hÆ¡n gÃ¬ ngoÃ i sá»± tiá»‡n Ã­ch.

### 4.1. Slice
#### 4.1.1. Æ¯u Ä‘iá»ƒm
- Reducer khÃ´ng cáº§n sá»­ dá»¥ng switch case thay vÃ o Ä‘Ã³ sá»­ dá»¥ng key-value(tÃªn reducer map vá»›i reducer).
- Há»— trá»£ immer giÃºp code reducer clean hÆ¡n.
- Há»— trá»£ phÃ¢n cáº¥p theo slice name Ä‘á»ƒ trÃ¡nh duplicate action type.
- ...

#### 4.1.2. Quy Æ°á»›c Ä‘áº·t tÃªn slice
- camelCase(loggedInUser, sidebar, ...)
- sá»­ dá»¥ng scope lÃ m prefix cho tÃªn cá»§a slice.  
  VÃ­ dá»¥: `global/loggedInUser`, `global/sidebar`, `page/auth/login`, ...
